<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.2 UCSB Server Clusters | emLab Standard Operating Procedures</title>
  <meta name="description" content="Standard operating procedures for emLab projects" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="4.2 UCSB Server Clusters | emLab Standard Operating Procedures" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://emlab-ucsb.github.io/SOP/" />
  
  <meta property="og:description" content="Standard operating procedures for emLab projects" />
  <meta name="github-repo" content="emlab-ucsb/SOP" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.2 UCSB Server Clusters | emLab Standard Operating Procedures" />
  
  <meta name="twitter:description" content="Standard operating procedures for emLab projects" />
  



<meta name="date" content="2019-08-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
<link rel="prev" href="4-1-google-cloud-platform.html">

<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="1-project-management.html"><a href="1-project-management.html"><i class="fa fa-check"></i><b>1</b> Project Management</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-google-calendar.html"><a href="1-1-google-calendar.html"><i class="fa fa-check"></i><b>1.1</b> Google Calendar</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-1-google-calendar.html"><a href="1-1-google-calendar.html#setting-out-of-office-notifications"><i class="fa fa-check"></i><b>1.1.1</b> Setting out of office notifications</a></li>
<li class="chapter" data-level="1.1.2" data-path="1-1-google-calendar.html"><a href="1-1-google-calendar.html#adding-other-calendars"><i class="fa fa-check"></i><b>1.1.2</b> Adding other calendars</a></li>
<li class="chapter" data-level="1.1.3" data-path="1-1-google-calendar.html"><a href="1-1-google-calendar.html#scheduling-rooms"><i class="fa fa-check"></i><b>1.1.3</b> Scheduling rooms</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-2-slack.html"><a href="1-2-slack.html"><i class="fa fa-check"></i><b>1.2</b> Slack</a><ul>
<li class="chapter" data-level="1.2.1" data-path="1-2-slack.html"><a href="1-2-slack.html#slack-basics"><i class="fa fa-check"></i><b>1.2.1</b> Slack basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="1-2-slack.html"><a href="1-2-slack.html#creating-a-channel"><i class="fa fa-check"></i><b>1.2.2</b> Creating a channel</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="1-3-airtable.html"><a href="1-3-airtable.html"><i class="fa fa-check"></i><b>1.3</b> Airtable</a><ul>
<li class="chapter" data-level="1.3.1" data-path="1-3-airtable.html"><a href="1-3-airtable.html#helpful-terminology"><i class="fa fa-check"></i><b>1.3.1</b> Helpful terminology</a></li>
<li class="chapter" data-level="1.3.2" data-path="1-3-airtable.html"><a href="1-3-airtable.html#getting-to-know-the-emlab-workspace"><i class="fa fa-check"></i><b>1.3.2</b> Getting to know the emLab workspace</a></li>
<li class="chapter" data-level="1.3.3" data-path="1-3-airtable.html"><a href="1-3-airtable.html#customizing-your-project-base"><i class="fa fa-check"></i><b>1.3.3</b> Customizing your project base</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="1-4-google-shared-drive.html"><a href="1-4-google-shared-drive.html"><i class="fa fa-check"></i><b>1.4</b> Google Shared Drive</a><ul>
<li class="chapter" data-level="1.4.1" data-path="1-4-google-shared-drive.html"><a href="1-4-google-shared-drive.html#general-structure"><i class="fa fa-check"></i><b>1.4.1</b> General structure</a></li>
<li class="chapter" data-level="1.4.2" data-path="1-4-google-shared-drive.html"><a href="1-4-google-shared-drive.html#sharing-files"><i class="fa fa-check"></i><b>1.4.2</b> Sharing files</a></li>
<li class="chapter" data-level="1.4.3" data-path="1-4-google-shared-drive.html"><a href="1-4-google-shared-drive.html#how-to-install-locally-juan-carlos"><i class="fa fa-check"></i><b>1.4.3</b> How to install locally (Juan Carlos)</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="1-5-github.html"><a href="1-5-github.html"><i class="fa fa-check"></i><b>1.5</b> GitHub</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-data.html"><a href="2-data.html"><i class="fa fa-check"></i><b>2</b> Data</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-tidy-data.html"><a href="2-1-tidy-data.html"><i class="fa fa-check"></i><b>2.1</b> Tidy Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="2-1-tidy-data.html"><a href="2-1-tidy-data.html#recommended-resources"><i class="fa fa-check"></i><b>2.1.1</b> Recommended Resources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-2-storage.html"><a href="2-2-storage.html"><i class="fa fa-check"></i><b>2.2</b> Storage</a></li>
<li class="chapter" data-level="2.3" data-path="2-3-metadata-and-data-directory.html"><a href="2-3-metadata-and-data-directory.html"><i class="fa fa-check"></i><b>2.3</b> Metadata and Data Directory</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-code.html"><a href="3-code.html"><i class="fa fa-check"></i><b>3</b> Code</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-scripts-and-version-control.html"><a href="3-1-scripts-and-version-control.html"><i class="fa fa-check"></i><b>3.1</b> Scripts and Version Control</a></li>
<li class="chapter" data-level="3.2" data-path="3-2-style-guide.html"><a href="3-2-style-guide.html"><i class="fa fa-check"></i><b>3.2</b> Style Guide</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-high-performance-computing.html"><a href="4-high-performance-computing.html"><i class="fa fa-check"></i><b>4</b> High Performance Computing</a><ul>
<li class="chapter" data-level="4.1" data-path="4-1-google-cloud-platform.html"><a href="4-1-google-cloud-platform.html"><i class="fa fa-check"></i><b>4.1</b> Google Cloud Platform</a></li>
<li class="chapter" data-level="4.2" data-path="4-2-ucsb-server-clusters.html"><a href="4-2-ucsb-server-clusters.html"><i class="fa fa-check"></i><b>4.2</b> UCSB Server Clusters</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-2-ucsb-server-clusters.html"><a href="4-2-ucsb-server-clusters.html#accessing-the-server-clusters"><i class="fa fa-check"></i><b>4.2.1</b> Accessing the server clusters</a></li>
<li class="chapter" data-level="4.2.2" data-path="4-2-ucsb-server-clusters.html"><a href="4-2-ucsb-server-clusters.html#managing-files"><i class="fa fa-check"></i><b>4.2.2</b> Managing files</a></li>
<li class="chapter" data-level="4.2.3" data-path="4-2-ucsb-server-clusters.html"><a href="4-2-ucsb-server-clusters.html#using-rsync-to-transfer-files"><i class="fa fa-check"></i><b>4.2.3</b> Using rsync to transfer files</a></li>
<li class="chapter" data-level="4.2.4" data-path="4-2-ucsb-server-clusters.html"><a href="4-2-ucsb-server-clusters.html#using-software-containers"><i class="fa fa-check"></i><b>4.2.4</b> Using software containers</a></li>
<li class="chapter" data-level="4.2.5" data-path="4-2-ucsb-server-clusters.html"><a href="4-2-ucsb-server-clusters.html#submitting-jobs"><i class="fa fa-check"></i><b>4.2.5</b> Submitting jobs</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">emLab Standard Operating Procedures</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ucsb-server-clusters" class="section level2">
<h2><span class="header-section-number">4.2</span> UCSB Server Clusters</h2>
<p>The Center for Scientific Computing at UCSB provides resources and support for research involving high performance computing, including multiple server clusters for storing and analyzing data. Find out more information at <a href="http://csc.cnsi.ucsb.edu/" class="uri">http://csc.cnsi.ucsb.edu/</a>. For a broader introduction to high performance computing with clusters see the HPC Carpentryâ€™s lessons at <a href="https://hpc-carpentry.github.io/" class="uri">https://hpc-carpentry.github.io/</a>. The following sections provide guidance for using the server clusters.</p>
<div id="accessing-the-server-clusters" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Accessing the server clusters</h3>
<p>To access the server clusters, you must first request a user account. The request form can be found at <a href="http://csc.cnsi.ucsb.edu/acct" class="uri">http://csc.cnsi.ucsb.edu/acct</a>. On the form, the job type selection should probably be GPU. In the job type description you should enter any relevant information related to user groups, access to specific folders, or special software usage. If needing Stata, you should request access under the <code>econ</code> group, which holds the license to use Stata. The system to be used should be Pod and Knot, which are the two primary Linux-based server clusters. Pod is the newest cluster and offers greater capabilities, but Knot is still adequate for most analysis needs and typically has less active users (i.e., a shorter queue). Either cluster allows 4 TB of storage per user and more can be requested if needed.</p>
<div id="on-campus" class="section level4">
<h4><span class="header-section-number">4.2.1.1</span> On campus</h4>
<p>Once your account has been created, the clusters can be accessed on campus via a terminal emulator using the <code>ssh</code> command or via a GUI SSH app, such as <a href="https://wiki.x2go.org/doku.php">X2Go</a>. On macOS or Linux the default terminal apps can be used. On Windows the <a href="https://www.putty.org/">PuTTY</a> or X2Go apps can be used. Once a terminal is started, connect to a cluster by entering one of the commands</p>
<pre><code>ssh user@knot.cnsi.ucsb.edu</code></pre>
<pre><code>ssh user@pod.cnsi.ucsb.edu</code></pre>
<p>where <code>user</code> is your server username. You will then be prompted for your password. SSH keys can also be set up to skip password entry.</p>
<p>Once connected, you will interact with the Linux server using the command line interface. The default working directory is your home folder <code>/home/user</code>. Note that this is the login node, but all analyses should be run on compute nodes. These analyses should be submitted as jobs (see <a href="4-2-ucsb-server-clusters.html#submitting-jobs">below</a>) to the queue, which allocates compute nodes.</p>
<p>To disconnect from the server, enter <code>exit</code>.</p>
</div>
<div id="off-campus" class="section level4">
<h4><span class="header-section-number">4.2.1.2</span> Off campus</h4>
<p>The servers can be accessed off campus using the UCSB Pulse Secure Connect VPN service for secure remote access. Instructions for installing the VPN app can be found at <a href="https://www.ets.ucsb.edu/services/campus-vpn/get-connected" class="uri">https://www.ets.ucsb.edu/services/campus-vpn/get-connected</a>. Once the app is installed, open it and select connect for UCSB Remote Access. You will then be prompted to enter your UCSBnetID and the associated password. Once connected, indicated by a green checkmark, you can then access the server as you normally would on campus by using a terminal or GUI SSH app.</p>
</div>
</div>
<div id="managing-files" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Managing files</h3>
<p>File management on the server clusters involves commonly used Linux commands to navigate and modify files and folders. The generic setup is <code>command [options] &lt;arguments&gt;</code>. Most of the following commands have multiple options that are not covered here. For detailed documentation enter <code>man command</code>. Additionally, for a broader introduction to Linux commands see the Software Carpentryâ€™s lessons at <a href="http://swcarpentry.github.io/shell-novice/" class="uri">http://swcarpentry.github.io/shell-novice/</a>.</p>
<div id="navigation" class="section level4">
<h4><span class="header-section-number">4.2.2.1</span> Navigation</h4>
<p><code>pwd</code> - present working directory</p>
<p><code>cd dir</code> - change directory<br />
<code>cd</code> - change to home directory (<code>/home/user</code>)<br />
<code>cd ..</code> - change to directory above</p>
<p><code>ls</code> - list all files in current directory<br />
<code>ls -a</code> - list all files, including hidden files<br />
<code>ls -l</code> - list all files with permission information</p>
<p><code>cp source destination</code> - copy file<br />
<code>mv source destination</code> - move file</p>
<p><code>mkdir name</code> - make directory<br />
<code>mkdir -m 770 name</code> - make directory with permissions (770 or other number)</p>
<p><code>rm file</code> - remove file<br />
<code>rmdir dir</code> - remove empty directory (equivalent to <code>rm -d dir</code>)<br />
<code>rm -r dir</code> - remove non-empty directory</p>
<p><code>shred -uz file</code> - securely overwrite and delete file</p>
</div>
<div id="viewing-creating-and-editing-files" class="section level4">
<h4><span class="header-section-number">4.2.2.2</span> Viewing, creating, and editing files</h4>
<p><code>file file.txt</code> - view file type information<br />
<code>stat file.txt</code> - view file information</p>
<p><code>more file.txt</code> - view text file one screen at a time (to exit press <code>q</code>)<br />
<code>less file.txt</code> - view text file with scrolling (to exit press <code>q</code>)</p>
<p><code>head file.csv</code> - print first ten rows of text file<br />
<code>tail file.csv</code> - print last ten rows of text file</p>
<p><code>head -1 file.csv</code> - print column names if in first row of text file</p>
<p><code>cut -d , -f 2,4-6 file.csv | less</code> - view specific columns of .csv file by number position (e.g., 2,4-6)</p>
<p>To view .csv files with pretty output, enter<br />
<code>cat file.csv | sed -e 's/,,/, ,/g' | column -s, -t | less -#5 -N -S</code><br />
Note: This may not work well for all files. Use arrow keys to navigate and enter <code>q</code> to exit.</p>
<p><code>cat &gt; file.txt</code> - create new text file<br />
<code>nano</code> - create new text file using nano text editor<br />
<code>nano file.txt</code> - view and edit text file using nano text editor</p>
<p><code>zip -r file.zip file1 folder1</code> - create compressed .zip file with recursion<br />
<code>unzip file.zip</code> - extract .zip file into working directory</p>
</div>
<div id="permissions" class="section level4">
<h4><span class="header-section-number">4.2.2.3</span> Permissions</h4>
<p>Sometimes file and folder permissions need to be modified, such as to restrict access to files. On Linux, read, write, and execute permissions are represented by octal notation and applied to the file owner, groups, and all other users.</p>
<table>
<thead>
<tr class="header">
<th align="left">#</th>
<th align="left">Permission</th>
<th align="left">rwx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">7</td>
<td align="left">read, write, and execute</td>
<td align="left">rwx</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">read and write</td>
<td align="left">rw-</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">read and execute</td>
<td align="left">r-x</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">read only</td>
<td align="left">râ€“</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">write and execute</td>
<td align="left">-wx</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">write only</td>
<td align="left">-w-</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">execute only</td>
<td align="left">â€“x</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">none</td>
<td align="left">â€”</td>
</tr>
</tbody>
</table>
<p>Common permissions include</p>
<p><code>-rwxrwx---</code> = <code>770</code> - owner and group can do everything, but others can do nothing<br />
<code>-rwxr-x---</code> = <code>750</code> - owner can do everything, group can read and execute only, but others can do nothing<br />
<code>-rwx------</code> = <code>700</code> - owner can do everything, but group and others can do nothing</p>
<p>To change permissions enter</p>
<p><code>chmod 770 dir</code> - change permissions for file or directory<br />
<code>chmod -R 770 dir</code> - change permissions recursively for directory<br />
<code>chgrp group file</code> - change group ownership for file or directory</p>
</div>
<div id="shortcuts" class="section level4">
<h4><span class="header-section-number">4.2.2.4</span> Shortcuts</h4>
<p><code>Ctrl-A</code> - move to beginning of line<br />
<code>Ctrl-E</code> - move to end of line<br />
<code>Ctrl-U</code> - clear line from cursor<br />
<code>Ctrl-C</code> - cancel command<br />
<code>*</code> - wildcard completion<br />
<code>Tab</code> - autocompletion<br />
<code>Up and down arrow keys</code> - cycle through command history</p>
</div>
<div id="transferring-files" class="section level4">
<h4><span class="header-section-number">4.2.2.5</span> Transferring files</h4>
<p>To transfer files between the server and your local computer, use <code>scp</code> or <code>rsync</code> commands in the terminal or use a SFTP GUI app. On macOS, <a href="https://cyberduck.io/">Cyberduck</a> and <a href="https://filezilla-project.org/">FileZilla</a> are good options. On Windows, <a href="https://winscp.net/eng/index.php">WinSCP</a> and FileZilla are good options. On Linux, FileZilla is a good option. Another option is to use <a href="http://csc.cnsi.ucsb.edu/docs/globus-online">Globus Online</a>, a web app for transferring large files.</p>
</div>
</div>
<div id="using-rsync-to-transfer-files" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Using rsync to transfer files</h3>
<p>The rsync command line tool provides fast, incremental file transfer. It can be used to transfer files between servers or between a local computer and a server. The primary use case for rsync is to sync two folders, such as a synced backup folder. For more detailed documentation see <a href="https://rsync.samba.org/" class="uri">https://rsync.samba.org/</a>.</p>
<p>The generic setup for an rsync command is</p>
<pre><code>rsync [options] &lt;source&gt; &lt;destination&gt;</code></pre>
<p>With an example of transferring an entire directory from a local computer to the Pod server cluster, a typical rsync command with commonly used options is</p>
<pre><code>rsync -avzP -e ssh /home/user/project/ user@pod.cnsi.ucsb.edu:/home/user/project</code></pre>
<p>This example represents a push transfer. A pull transfer could also be completed by simply switching the source and destination. When transferring entire directories, a forward slash on the source matters but never for the destination. In this case, the â€˜projectâ€™ folder has a forward slash and all its contents will be replicated exactly in the destination â€˜projectâ€™ folder, copying all contents except the top â€˜projectâ€™ folder. Without the forward slash on the source there would be another â€˜projectâ€™ folder within the â€˜projectâ€™ folder at the destination.</p>
<p>The rsync options can be specified in short or long forms. In this use case, the <code>-a</code> or <code>--archive</code> option completely replicates all folders and files, including recursively through all subdirectories while preserving symbolic links, permissions, and ownership. The <code>-v</code> or <code>--verbose</code> option increases the amount of information that is logged. The <code>-z</code> or <code>--compress</code> option compresses files during transit to reduce transfer time. The <code>-P</code> or <code>--partial --progress</code> option enables partially transferred files to be kept in case of a break or pause and also displays the progress of individual file transfers. Many other options exist, but these are the primary ones. Additionally, add the <code>-n</code> or <code>--dry-run</code> option to test what an rsync command will do without making changes.</p>
<p>After the command is submitted, the user will be prompted for a password if transferring to or from a server. If using rsync frequently, SSH keys can also be set up to skip password entry.</p>
<p>For large transfers, sometimes the process needs to be paused and resumed, or sometimes the transfer can be interrupted due to a server, network, or power outage. The <code>-P</code> or <code>--partial</code> option should always be used to preserve the files or parts of files that have already been transferred and to avoid having to start over. To pause a transfer, use <code>Ctrl-C</code>. To resume, resubmit the same rsync command with the <code>--append</code> option added, which will restart the transfer where it left off. When syncing to a backup folder, add the <code>--delete</code> option to delete files and folders that have been deleted in the source.</p>
</div>
<div id="using-software-containers" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Using software containers</h3>
<p>Software containers can be used on the server clusters via <a href="https://sylabs.io/singularity/">Singularity</a>. Containers enable fully reproducible research by packaging a computing environment and the necessary software packages and applications as a self-contained image file that can be easily transferred to and run on any other system. They are also useful for collaborating across different institutions and computing infrastructures. Find out more information at <a href="http://csc.cnsi.ucsb.edu/docs/containers" class="uri">http://csc.cnsi.ucsb.edu/docs/containers</a>.</p>
</div>
<div id="submitting-jobs" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Submitting jobs</h3>
<p>The server clusters are shared resources, and a job queue process is used to manage and allocate resources among users. A job is simply a set of instructions that includes requests for resources and the specific set of commands to be executed, such as commands for analyzing data. When a user submits a job to the server for execution it enters the queue and is scheduled for a specific time.</p>
<div id="knot" class="section level4">
<h4><span class="header-section-number">4.2.5.1</span> Knot</h4>
<p>The Knot cluster uses <a href="http://csc.cnsi.ucsb.edu/docs/example-scripts-running-jobs">TORQUE PBS</a> to schedule jobs.</p>
<p>First create a new .pbs file with the command</p>
<pre><code>nano submit.pbs</code></pre>
<p>The typical structure of a .pbs file for a serial job using R is</p>
<pre><code>#!/bin/bash
#PBS -l nodes=1:ppn=12
#PBS -l walltime=2:00:00
#PBS -V

cd $PBS_O_WORKDIR

Rscript script.R</code></pre>
<p>where 1 node is requested with a 2-hour timeframe for computation. The <code>walltime</code> option can be excluded if the computation time is unknown. The <code>Rscript script.R</code> line executes the commands in the specified R script. The filepath for the script should be relative to where the .pbs file is located or an absolute path can also be used. This line would change if using different software. There are also many other <code>#PBS</code> options that can be included. Parallel jobs require different specifications, such as requesting more than 1 node and using <code>mpirun</code> commands.</p>
<p>For another example, the structure for a serial job using Stata and that sends e-mail notifications when a job begins and ends is</p>
<pre><code>#!/bin/bash
#PBS -l nodes=1:ppn=12
#PBS -V
#PBS -m be
#PBS -M user@ucsb.edu

cd $PBS_O_WORKDIR/

/sw/stata/stata-mp -b do script.do</code></pre>
<p>To submit a job, use the command</p>
<pre><code>qsub submit.pbs</code></pre>
<p>For jobs that require less than one hour, use the short queue to minimize waiting time with the command</p>
<pre><code>qsub -q short submit.pbs</code></pre>
<p>For jobs that require large memory, use one of the commands</p>
<pre><code># 256 GB/node
qsub -q largemem submit.pbs 
# or 512 GB/node
qsub -q xlargemem submit.pbs</code></pre>
<p>The <code>qsub</code> command will return a job number. To check the status of a job, use the command</p>
<pre><code>qstat &lt;job number&gt;</code></pre>
<p>To cancel or delete a job, use the command</p>
<pre><code>qdel &lt;job number&gt;</code></pre>
<p>The outputs of the analysis in the script will be returned in the same folder as the .pbs file that was submitted, typically with the filename structure <code>submit.pbs.[job number]</code> unless otherwise specified.</p>
</div>
<div id="pod" class="section level4">
<h4><span class="header-section-number">4.2.5.2</span> Pod</h4>
<p>The Pod cluster uses <a href="http://csc.cnsi.ucsb.edu/docs/slurm-job-scheduler">SLURM</a> to schedule jobs.</p>
<p>First create a new .job file with the command</p>
<pre><code>nano submit.job</code></pre>
<p>The typical structure of a .job file for a serial job using R is</p>
<pre><code>#!/bin/bash -l
#Serial
#SBATCH --nodes=1 --ntasks-per-node=1

cd $SLURM_SUBMIT_DIR

module load R
Rscript script.R</code></pre>
<p>where 1 node is requested. The <code>module load R</code> line loads R, and then the <code>Rscript script.R</code> line executes the commands in the specified R script. The filepath for the script should be relative to where the .job file is located or an absolute path can also be used. These last two lines would change if using different software. There are also many other <code>#SBATCH</code> options that can be included. Parallel jobs require different specifications, such as requesting more than 1 node and using <code>mpirun</code> commands.</p>
<p>For another example, the structure for a serial job using Stata and that sends e-mail notifications is</p>
<pre><code>#!/bin/bash -l
#Serial
#SBATCH --nodes=1 --ntasks-per-node=1
#SBATCH --mail-type=ALL
#SBATCH --mail-user=user@ucsb.edu

cd $SLURM_SUBMIT_DIR

/sw/stata/stata-mp -b do script.do</code></pre>
<p>To submit a job, use the command</p>
<pre><code>sbatch submit.job</code></pre>
<p>For jobs that require less than one hour, use the short queue to minimize waiting time with the command</p>
<pre><code>sbatch -p short submit.job</code></pre>
<p>For jobs that require large memory, use the command</p>
<pre><code># 1.5 TB/node
sbatch -p fat submit.job</code></pre>
<p>The <code>sbatch</code> command will return a job number. To check the status of a job, use one of the commands</p>
<pre><code>showq &lt;job number&gt;
# or
showq | grep mdono
# or
squeue -u $USER</code></pre>
<p>To cancel or delete a job, use the command</p>
<pre><code>scancel -i &lt;job number&gt;</code></pre>
<p>The outputs of the analysis in the script will be returned in the same folder as the .job file that was submitted, typically with the filename structure <code>slurm-[jobnumber].out</code> unless otherwise specified.</p>
</div>
<div id="available-software" class="section level4">
<h4><span class="header-section-number">4.2.5.3</span> Available software</h4>
<p>The software available on the clusters includes R, Stata, Python, Julia, MATLAB, Git, and LaTeX. Additional information about available software, using different versions of software, and installing packages can be found at <a href="http://csc.cnsi.ucsb.edu/docs/scientific-software" class="uri">http://csc.cnsi.ucsb.edu/docs/scientific-software</a>.</p>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="4-1-google-cloud-platform.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
},
"search": true
});
});
</script>

</body>

</html>
